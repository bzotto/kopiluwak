<html>
<head>
	<script src="utf.js"></script>
	<script src="stdio.js"></script>
	<script src="logdbg.js"></script>
	<script src="constants.js"></script>
	<script src="float.js"></script>
	<script src="long.js"></script>
	<script src="types.js"></script>
	<script src="objects.js"></script>
	<script src="jdk.js"></script>
	<script src="classloader.js"></script>
	<script src="jvm.js"></script>
	<script src="native.js"></script>
	<script src="exec.js"></script>
	<script>
								
		// 8 = backspace, 13 = enter		
		setTimeout(function() {
			document.getElementById('console').addEventListener('keydown', function (e){
			    e = e || window.event;
				let keycode = e.which || e.keyCode;
				if (keycode == 8) {
					stdinfunnel([keycode]);
				}
			}, false);
			document.getElementById('console').addEventListener('keypress', function (e){
			    e = e || window.event;
				let keycode = e.which || e.keyCode;
				stdinfunnel([keycode]);
				
			}, false);
			
		}, 0);
						
		function appendTextToTextareaObj(textarea, str) {
			let outstr = textarea.value + str;
			textarea.value = outstr;
		}
		
		function stdouthook(linestr) {
			let outbox = document.getElementById("console");
			appendTextToTextareaObj(outbox, linestr);
		}
		
		function logouthook(linestr) {
			let outbox = document.getElementById("logoutput");
			appendTextToTextareaObj(outbox, linestr + "\n");
			outbox.scrollTop = outbox.scrollHeight;
		}
		
		function stdinfunnel(bytes) {
			setTimeout(function() {
				KLJVMSubmitInput(KLFD_stdin, bytes);
				KLJVMExecute();
			}, 0);
		}
		
		function runnit() {
			if (!KLJVMStarted) { alert("Startup the JVM before loading this class."); }
			var src = document.getElementById("sourcehex").value;
			KLJVMExecute(src);
		}
		
		function startup() {
			KLJVMStartup({ out: stdouthook }, logouthook);
		}
		
		</script>
		<style type="text/css">
			textarea {
				width:500px;
				height:100px;
			};
		</style>
</head>
<body>
	<h2>Kopiluwak (s)crappy JVM</h2>
	<hr>
	<button type="button" onclick=startup()>Startup JVM</button> &leftarrow; do this first, once
	
	<h4>Compiled Java class file with a <i>main</i> method:</h4>
	<!-- CAFEBABE 0000003B 001D0A00 02000307 00040C00 05000601 00106A61 76612F6C 616E672F 4F626A65 63740100 063C696E 69743E01 00032829 56090008 00090700 0A0C000B 000C0100 106A6176 612F6C61 6E672F53 79737465 6D010003 6F757401 00154C6A 6176612F 696F2F50 72696E74 53747265 616D3B08 000E0100 0B48656C 6C6F2057 6F726C64 0A001000 11070012 0C001300 14010013 6A617661 2F696F2F 5072696E 74537472 65616D01 00077072 696E746C 6E010015 284C6A61 76612F6C 616E672F 53747269 6E673B29 56070016 01000A48 656C6C6F 576F726C 64010004 436F6465 01000F4C 696E654E 756D6265 72546162 6C650100 046D6169 6E010016 285B4C6A 6176612F 6C616E67 2F537472 696E673B 29560100 0A536F75 72636546 696C6501 000F4865 6C6C6F57 6F726C64 2E6A6176 61002000 15000200 00000000 02000000 05000600 01001700 00001D00 01000100 0000052A B70001B1 00000001 00180000 00060001 00000001 00090019 001A0001 00170000 00250002 00010000 0009B200 07120DB6 000FB100 00000100 18000000 0A000200 00000300 08000400 01001B00 00000200 1C -->
	
	<textarea id="sourcehex">
CAFEBABE 0000003B 003F0A00 02000307 00040C00 05000601 00106A61 76612F6C 616E672F 4F626A65 63740100 063C696E 69743E01 00032829 56080008 01000009 000A000B 07000C0C 000D000E 0100106A 6176612F 6C616E67 2F537973 74656D01 00036F75 74010015 4C6A6176 612F696F 2F507269 6E745374 7265616D 3B080010 01001052 65616C6D 2028652E 672E202F 293A200A 00120013 0700140C 00150016 0100136A 6176612F 696F2F50 72696E74 53747265 616D0100 05707269 6E740100 15284C6A 6176612F 6C616E67 2F537472 696E673B 29560700 18010016 6A617661 2F696F2F 42756666 65726564 52656164 65720700 1A010019 6A617661 2F696F2F 496E7075 74537472 65616D52 65616465 7209000A 001C0C00 1D001E01 0002696E 0100154C 6A617661 2F696F2F 496E7075 74537472 65616D3B 0A001900 200C0005 00210100 18284C6A 6176612F 696F2F49 6E707574 53747265 616D3B29 560A0017 00230C00 05002401 0013284C 6A617661 2F696F2F 52656164 65723B29 560A0017 00260C00 27002801 00087265 61644C69 6E650100 1428294C 6A617661 2F6C616E 672F5374 72696E67 3B08002A 01002C4C 6F67696E 206D6F64 756C6520 6E616D65 2028652E 672E2044 61746153 746F7265 206F7220 4C444150 293A2008 002C0100 244C6F67 696E206C 6F63616C 65202865 2E672E20 656E5F55 53206F72 2066725F 4652293A 2007002E 0100136A 6176612F 696F2F49 4F457863 65707469 6F6E0A00 1200300C 00310016 01000770 72696E74 6C6E0700 33010010 4A617661 496E7075 74457861 6D706C65 01000443 6F646501 000F4C69 6E654E75 6D626572 5461626C 65010004 6D61696E 01001628 5B4C6A61 76612F6C 616E672F 53747269 6E673B29 5601000D 53746163 6B4D6170 5461626C 6507003A 0100135B 4C6A6176 612F6C61 6E672F53 7472696E 673B0700 3C010010 6A617661 2F6C616E 672F5374 72696E67 01000A53 6F757263 6546696C 65010015 4A617661 496E7075 74457861 6D706C65 2E6A6176 61002100 32000200 00000000 02000100 05000600 01003400 00001D00 01000100 0000052A B70001B1 00000001 00350000 00060001 00000002 00090036 00370001 00340000 00C70005 00040000 00661207 4CB20009 120FB600 11BB0017 59BB0019 59B2001B B7001FB7 0022B600 254CB200 091229B6 0011BB00 1759BB00 1959B200 1BB7001F B70022B6 00254DB2 0009122B B60011BB 001759BB 001959B2 001BB700 1FB70022 B600254E A700044D B200092B B6002FB1 00010003 005A005D 002D0002 00350000 002E000B 00000006 00030008 000B0009 0020000B 0028000C 003D000E 0045000F 005A0012 005D0010 005E0013 00650014 00380000 00130002 FF005D00 02070039 07003B00 0107002D 00000100 3D000000 02003E</textarea>	<br/>


	<button type="button" onclick=runnit()>Execute class</button>
	<hr>
	VM log output:<br/>
	<textarea id="logoutput" readonly></textarea>
	<br/>
	Console I/O:<br/>
	<textarea id="console"></textarea>
</body>
</html>